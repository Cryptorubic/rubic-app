<section class="token-block" *ngIf="token">
  <div class="token-block__area area-first">
    <div class="area-first__amount-total">{{ shortedAmountTotal }}</div>

    <div class="area-fist__sent-left-amounts sent-left-amounts">
      <span class="sent-left-amounts__label">{{ 'tradePage.sent' | translate }}</span>
      <span class="sent-left-amounts__number">
        {{ token.amountContributed | bigNumberFormat }}
      </span>

      <span class="sent-left-amounts__label">{{ 'tradePage.left' | translate }}</span>
      <span class="sent-left-amounts__number" *ngIf="!token.amountLeft?.isNaN()">{{
        token.amountLeft | bigNumberFormat
      }}</span>
    </div>
  </div>

  <div class="token-block__area area-second" [ngClass]="{ 'area-second_to': tokenPart === 'to' }">
    <div
      class="area-second__progress-bar"
      *ngIf="token.amountContributed"
      [style.width]="token.amountContributed.div(token.amountTotal).times(100).toFixed() + '%'"
    ></div>

    <div class="area-second__investors investors" [ngClass]="{ investors_to: tokenPart === 'to' }">
      <span class="investors__amount">{{ token.investorsNumber }} / 10</span>
      <span class="investors__text">{{ 'tradePage.investors' | translate }}</span>
    </div>

    <div
      class="area-second__token-info token-info"
      [ngClass]="{ 'token-info_to': tokenPart === 'to' }"
    >
      <div class="token-info__text">
        <span class="token-info__title" [ngClass]="{ 'token-info__title_to': tokenPart === 'to' }">
          {{ token.name + ' (' + token.symbol + ')' }}
        </span>

        <app-scanner-link
          [address]="token.address"
          [blockchainName]="token.blockchain"
          [addressType]="ADDRESS_TYPE.TOKEN"
        >
        </app-scanner-link>
      </div>

      <div class="token-info__image-container">
        <img
          [src]="token.image || '/assets/images/icons/coins/empty.svg'"
          width="50"
          height="50"
          alt="token"
        />
      </div>
    </div>
  </div>

  <div
    class="token-block__area area-third"
    *ngIf="
      tradeData.status === TRADE_STATUS.ACTIVE &&
      walletAddress &&
      token.isApproved !== undefined &&
      !token.amountLeft?.isNaN()
    "
  >
    <label class="area-third__amount-label">
      <input
        class="area-third__amount-input"
        [placeholder]="token.isApproved ? 'Enter amount' : ''"
        [disabled]="!token.isApproved"
        appNumberPrecision
        [inputElement]="amountToContributeInput"
        [decimalLength]="token.decimals"
        [minValue]="getMinContributionAsString()"
        [maxValue]="token.amountLeft.toFixed()"
        [ngModel]="amountToContribute"
        (ngModelChange)="setAmountToContribute($event)"
        #amountToContributeModel="ngModel"
        [ngClass]="{
          'area-third__amount-input_invalid': amountToContributeModel.invalid
        }"
        #amountToContributeInput
      />
    </label>

    <div class="area-third__confirm-button">
      <app-primary-button
        [label]="token.isApproved ? 'Contribute' : 'Approve'"
        [animate]="
          operationStatus.approve === TX_STATUS.STARTED ||
          operationStatus.approve === TX_STATUS.IN_PROGRESS ||
          operationStatus.contribute === TX_STATUS.STARTED ||
          operationStatus.contribute === TX_STATUS.IN_PROGRESS
        "
        [disabled]="
          (token.isApproved &&
            !(amountToContributeAsNumber?.isGreaterThan(0) && amountToContributeModel.valid)) ||
          isOperationInProgress
        "
        (onClick)="makeApproveOrContribute()"
      ></app-primary-button>
    </div>

    <div
      class="area-third__amount-to-get amount-to-get"
      *ngIf="
        token.isApproved &&
        amountToContributeAsNumber?.isGreaterThan(0) &&
        amountToContributeModel.valid
      "
    >
      {{ 'tradePage.getBefore' | translate }}
      <span class="amount-to-get__number">{{ oppositeTokenToGet }}</span>
      {{ 'tradePage.getAfter' | translate }}
    </div>

    <button
      class="area-third__fill-button"
      [disabled]="!token.isApproved"
      (click)="setAmountToContribute(token.amountLeft.toFixed())"
    >
      {{ 'tradePage.find' | translate }}
    </button>
  </div>

  <div
    class="token-block__area area-fourth"
    *ngIf="tradeData.status === TRADE_STATUS.ACTIVE && walletAddress"
  >
    <div
      class="area-fourth__min-contribution"
      *ngIf="
        !token.amountLeft?.isNaN() &&
        getMinContributionAsString() &&
        token.minContribution.isGreaterThan(0)
      "
    >
      {{ 'tradePage.limit' | translate }}
      {{ getMinContributionAsString() + ' ' + token.symbol }}
    </div>

    <div
      class="area-fourth__brokers-fee"
      *ngIf="tradeData.isWithBrokerFee && token.brokerPercent > 0"
    >
      {{ 'tradePage.fee' | translate }}
      {{
        token.brokerPercent +
          '% (' +
          (token.amountTotal.div(100).times(this.token.brokerPercent).dp(this.token.decimals)
            | bigNumberFormat) +
          ' ' +
          token.symbol +
          ')'
      }}
    </div>
  </div>

  <div
    class="token-block__area area-fifth"
    *ngIf="tradeData.status === TRADE_STATUS.ACTIVE && !walletAddress"
  >
    <button class="area-fifth__connect-wallet-button" (click)="onConnectWallet()">
      {{ 'navigation.login' | translate }}
    </button>
  </div>

  <div
    class="token-block__area area-sixth"
    *ngIf="
      (tradeData.status === TRADE_STATUS.ACTIVE || tradeData.status === TRADE_STATUS.EXPIRED) &&
      walletAddress &&
      token.amountContributed?.isGreaterThan(0)
    "
  >
    <app-withdraw-button
      [animated]="
        operationStatus.withdraw === TX_STATUS.STARTED ||
        operationStatus.withdraw === TX_STATUS.IN_PROGRESS
      "
      [disabled]="isOperationInProgress"
      (onClick)="makeWithdraw()"
    ></app-withdraw-button>
  </div>
</section>

<app-operation-in-progress-modal *ngIf="isOperationInProgress"></app-operation-in-progress-modal>

<app-operation-completed-modal
  *ngIf="isOperationCompleted"
  [transactionId]="lastCompletedTransactionId"
  [blockchain]="tradeData.blockchain"
></app-operation-completed-modal>
