<div class="swap-container" *ngLet="formContent$ | async as content">
  <div
    class="form"
    *ngLet="displayTargetAddressInput$ | async as displayReceiver"
    [ngClass]="{
      form_small: content === 'preview',
      form_tokens: content === 'fromSelector' || content === 'toSelector'
    }"
  >
    <app-window-container>
      <ng-container header>
        <ng-container *ngIf="content === 'fromSelector'">
          <span class="back-button" (click)="handleTokenSelect('from', null)">
            <img class="back-button__image" src="/assets/images/icons/arrow-back.svg" alt="" />
          </span>
          Swap Form
        </ng-container>
        <ng-container *ngIf="content === 'toSelector'">
          <span (click)="handleTokenSelect('from', null)">Back</span>
          Swap Form
        </ng-container>
        <ng-container *ngIf="content === 'form'">
          Rubic.exchange
          <div class="actions">
            <app-refresh-button class="swap-form__refresh">
              <!--
              *ngIf="
                (isInstantTrade || isCrossChainRouting || isOnramper) &&
                isFormFilled &&
                allowRefresh
              "
              mode="swaps"
              [isRotating$]="isRefreshRotating$"
              (onRefresh)="onRefresh()"
              -->
            </app-refresh-button>
            <app-settings-container class="swap-form__settings"></app-settings-container>
          </div>
        </ng-container>
        <ng-container *ngIf="content === 'preview'">
          <span class="back-button" (click)="handleTokenSelect('from', null)">
            <img class="back-button__image" src="/assets/images/icons/arrow-back.svg" alt="" />
          </span>
          Preview Swap
        </ng-container>
      </ng-container>
      <!-- Trade -->
      <ng-container *ngIf="content === 'form'">
        <div class="form__container">
          <app-input-output-container round="top">
            <app-asset-selector
              left
              (handleAssetSelection)="openTokensSelect('from')"
              [asset]="fromAsset$ | async"
            ></app-asset-selector>
            <div right class="input-container">
              <app-amount-transput
                formType="from"
                [selectedToken]="fromAsset$ | async"
                inputMode="input"
                (amountUpdated)="updateInputValue($event)"
                [amountValue]="fromAmount$ | async"
              ></app-amount-transput>
            </div>
          </app-input-output-container>

          <app-input-output-container [round]="displayReceiver ? 'none' : 'bottom'">
            <app-asset-selector
              left
              (handleAssetSelection)="openTokensSelect('to')"
              [asset]="toAsset$ | async"
            ></app-asset-selector>
            <div right class="input-container">
              <app-amount-transput
                formType="to"
                [selectedToken]="toAsset$ | async"
                inputMode="output"
                [amountValue]="toAmount$ | async"
              ></app-amount-transput>
            </div>
          </app-input-output-container>
        </div>

        <app-target-network-address
          *ngIf="displayReceiver"
          @receiverAnimation
        ></app-target-network-address>

        <ng-container footer>
          <div class="buttons-container">
            <app-action-button></app-action-button>
            <app-receiver-address-button
              (handleClick)="toggleReceiver()"
            ></app-receiver-address-button>
          </div>
        </ng-container>
      </ng-container>
      <ng-container *ngIf="content === 'fromSelector'">
        <app-assets-selector-page
          [type]="'from'"
          (tokenSelect)="handleTokenSelect('from', $event)"
        ></app-assets-selector-page>
      </ng-container>
      <ng-container *ngIf="content === 'toSelector'">
        <app-assets-selector-page
          [type]="'to'"
          (tokenSelect)="handleTokenSelect('to', $event)"
        ></app-assets-selector-page>
      </ng-container>
      <ng-container *ngIf="content === 'preview'">
        <app-preview-swap></app-preview-swap>
      </ng-container>
    </app-window-container>
  </div>

  <app-providers-list
    *ngIf="(showProviders$ | async) && content === 'form'"
    @inOutAnimation
    [states]="providers$ | async"
    [selectedTradeType]="selectedTradeType$ | async"
    (selectTrade)="selectTrade($event)"
  ></app-providers-list>
</div>
