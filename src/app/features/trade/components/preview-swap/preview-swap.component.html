<app-window-container
  *ngLet="{
    tradeInfo: tradeInfo$ | async,
    tradeState: tradeState$ | async,
    transaction: transactionState$ | async
  } as state"
>
  <ng-container header>
    <span class="back-button" (click)="backToForm()">
      <img class="back-button__image" src="/assets/images/icons/arrow-back.svg" alt="" />
      <ng-container *ngIf="state.transaction.step === 'idle'">Preview Swap</ng-container>
      <ng-container *ngIf="state.transaction.step === 'success'">Success Swap</ng-container>
      <ng-container
        *ngIf="state.transaction.step !== 'idle' && state.transaction.step !== 'success'"
        >Swap</ng-container
      >
    </span>
  </ng-container>
  <ng-container>
    <div class="preview">
      <div class="preview__data-container">
        <div class="preview__io-container">
          <div class="preview__token-container">
            <div
              class="preview__second-image-container"
              [style]="{ background: state.tradeInfo.fromAsset.secondColor }"
            >
              <img
                [src]="state.tradeInfo.fromAsset.secondImage"
                [alt]="state.tradeInfo.fromAsset.secondImage"
              />
            </div>
            <img
              class="preview__main-image"
              [src]="state.tradeInfo.fromAsset.mainImage"
              [alt]="state.tradeInfo.fromAsset.mainLabel"
            />
          </div>
          <div class="preview__amount-container">
            <div class="preview__token-amount">
              {{
                state.tradeInfo.fromValue.tokenAmount | bigNumberFormat | shortenAmount : 8 : 6
              }}&nbsp;{{ state.tradeInfo.fromAsset.mainLabel }}
            </div>
            <div
              *ngIf="state.tradeInfo.fromValue.fiatAmount as amount"
              class="preview__fiat-amount"
            >
              ~ ${{ amount }}&nbsp;-&nbsp;
            </div>
            <div class="preview__token-info">
              on
              {{ state.tradeInfo.fromAsset.secondLabel }}
            </div>
          </div>
        </div>

        <app-route-element
          *ngIf="state.transaction.step === 'idle'"
          [routes]="state.tradeState?.routes || []"
        ></app-route-element>
        <app-transaction-state
          *ngIf="state.transaction.step !== 'idle' && state.transaction.step !== 'success'"
          [transactionData]="{
            type:
              state.tradeInfo.fromAsset.secondLabel === state.tradeInfo.toAsset.secondLabel
                ? 'swap'
                : 'bridge',
            needApprove: state.tradeState.needApprove
          }"
          [state]="state.transaction.step"
        ></app-transaction-state>

        <div class="preview__io-container">
          <div class="preview__token-container">
            <div
              class="preview__second-image-container"
              [style]="{ background: state.tradeInfo.toAsset.secondColor }"
            >
              <img
                [src]="state.tradeInfo.toAsset.secondImage"
                [alt]="state.tradeInfo.toAsset.secondImage"
              />
            </div>
            <img
              class="preview__main-image"
              [src]="state.tradeInfo.toAsset.mainImage"
              [alt]="state.tradeInfo.toAsset.mainLabel"
            />
          </div>
          <div class="preview__amount-container">
            <div class="preview__token-amount">
              {{ state.tradeInfo.toValue.tokenAmount | bigNumberFormat | shortenAmount : 8 : 6 }}
            </div>
            <div *ngIf="state.tradeInfo.toValue.fiatAmount as amount" class="preview__fiat-amount">
              ~ ${{ amount }}&nbsp;-&nbsp;
            </div>
            <div class="preview__token-info">
              {{ state.tradeInfo.toAsset.mainLabel }} on {{ state.tradeInfo.toAsset.secondLabel }}
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="state.transaction.step !== 'success'" class="preview__swap-info">
        <app-swap-data-element
          [gasInfo]="getGasData(state.tradeState.trade)"
          [feeInfo]="state.tradeState?.feeInfo || null"
          [time]="time"
        ></app-swap-data-element>
      </div>

      <div *ngIf="state.transaction.step === 'success'" class="preview__buttons">
        <a
          tuiButton
          appearance="primary"
          type="button"
          size="m"
          [safetyLink]="
            state.transaction.data.hash
              | scannerLink : state.transaction.data.toBlockchain : ADDRESS_TYPE.TRANSACTION
          "
        >
          Explorer
        </a>

        <button tuiButton appearance="primary" type="button" size="m" (click)="navigateToHistory()">
          See Details >
        </button>
      </div>

      <div *ngIf="state.transaction.step !== 'success'" class="preview__transaction-details">
        <app-transaction-details></app-transaction-details>
      </div>

      <div *ngIf="state.transaction.step === 'success'" class="preview__success-info">
        <app-success-swap-info></app-success-swap-info>
      </div>
    </div>

    <button
      class="preview__action-button"
      *ngLet="buttonState$ | async as buttonState"
      tuiButton
      appearance="primary"
      type="button"
      size="m"
      (click)="buttonState.action()"
      [disabled]="buttonState.disabled"
    >
      {{ buttonState.label }}
    </button>
  </ng-container>
</app-window-container>
